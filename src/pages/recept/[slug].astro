---
import Layout from '../../layouts/Layout.astro';
import ShareButton from '../../components/ShareButton.jsx';

// Dit is de "boodschappenlijst" voor Astro
export async function getStaticPaths() {
  const apiBase = import.meta.env.PUBLIC_API_URL;
  const response = await fetch(`${apiBase}/api/recipes`);
  const recipes = await response.json();

  return recipes.map((recipe) => ({
    params: { slug: recipe.slug },
    props: { recipe }, // We geven het recept direct door als 'prop'
  }));
}

// Haal de props op die door getStaticPaths zijn doorgegeven
const { recipe } = Astro.props;
---

<Layout title={recipe ? recipe.title : 'Recept niet gevonden'}>
	{recipe ? (
		<article>
			<h1 class="text-5xl font-serif-display mb-4">{recipe.title}</h1>
			<div class="flex flex-wrap items-center gap-x-4 gap-y-2 mb-8 text-gray-600">
				<span><strong>Categorie:</strong> {recipe.category}</span>
				<span><strong>Tijd:</strong> {recipe.prep_time}</span>
				<span><strong>Stand:</strong> {recipe.creami_function}</span>
				<ShareButton client:load recipeId={recipe.id} initialCount={recipe.share_count} />
			</div>
      {recipe.submitter_name && <p class="mb-8 italic text-gray-500">✍️ Ingezonden door: {recipe.submitter_name}</p>}

			<div class="grid grid-cols-1 md:grid-cols-3 gap-12">
				<aside class="md:col-span-1 md:sticky top-24 h-fit bg-white/50 backdrop-blur-sm p-6 rounded-lg shadow-sm">
					<h2 class="text-3xl font-serif-display mb-4">Ingrediënten</h2>
					<ul class="space-y-2">
						{JSON.parse(recipe.ingredients).map(ing => (
							<li class="flex justify-between">
								<span>{ing.name}</span>
								<span class="font-bold">{ing.amount}</span>
							</li>
						))}
					</ul>
				</aside>

				<section class="md:col-span-2">
					<h2 class="text-3xl font-serif-display mb-4">Bereiding</h2>
					<div class="prose max-w-none text-lg" set:html={recipe.instructions}>
					</div>
				</section>
			</div>
		</article>
	) : (
		<p>Dit recept kon niet worden gevonden.</p>
	)}
</Layout>